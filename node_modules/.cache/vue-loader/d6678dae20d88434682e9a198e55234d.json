{"remainingRequest":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\src\\components\\sys\\basic\\PositionMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\src\\components\\sys\\basic\\PositionMana.vue","mtime":1611658510000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiUG9zaXRpb25NYW5hIiwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcm9sZTogewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIG5hbWVaaDogJycKICAgICAgfSwKICAgICAgcm9sZXM6IFtdLAogICAgICBhbGxNZW51czogW10sCiAgICAgIGRlZmF1bHRQcm9wczogeyAvLyDmoJHlvaLmjqfku7YKICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywKICAgICAgICBsYWJlbDogJ25hbWUnIC8vIOe7keWumuaVsOaNriA6bmFtZT0ici5pZCIKICAgICAgfSwKICAgICAgc2VsZWN0ZWRNZW51czogW10sCiAgICAgIGFjdGl2ZU5hbWU6IC0xIC8vIOaKmOWPoOmdouadvyDpu5jorqTlhbPpl60KICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXRSb2xlcygpCiAgICB0aGlzLmluaXRBbGxNZW51cygpCiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDliKDpmaTop5LoibIKICAgIGRvRGVsZXRlUm9sZShyb2xlKXsKICAgICAgdGhpcy4kY29uZmlybSgn5q2k5pON5L2c5bCG5rC45LmF5Yig6ZmkWycgKyByb2xlLm5hbWVaaCArICdd6KeS6ImyLCDmmK/lkKbnu6fnu60/JywgJ+aPkOekuicsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMuZGVsZXRlUmVxdWVzdCgnL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL3JvbGUvJyArIHJvbGUuaWQpLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgICB0aGlzLmluaXRSb2xlcygpCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ2luZm8nLAogICAgICAgICAgbWVzc2FnZTogJ+W3suWPlua2iOWIoOmZpCcKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgfSwKICAgIC8vIOa3u+WKoOinkuiJsgogICAgZG9BZGRSb2xlKCl7CiAgICAgIGlmICh0aGlzLnJvbGUubmFtZSAmJiB0aGlzLnJvbGUubmFtZVpoKSB7CiAgICAgICAgdGhpcy5wb3N0UmVxdWVzdCgnL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL3JvbGUnLHRoaXMucm9sZSkudGhlbihyZXNwPT57CiAgICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgICB0aGlzLmluaXRSb2xlcygpCiAgICAgICAgICAgIHRoaXMucm9sZS5uYW1lID0gJycKICAgICAgICAgICAgdGhpcy5yb2xlLm5hbWVaaCA9ICcnCiAgICAgICAgICB9CiAgICAgICAgfSkKCiAgICAgIH1lbHNlIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfmiYDmnInlrZfmrrXkuI3og73kuLrnqbrvvIEnKQogICAgICB9CiAgICB9LAogICAgLy8g5Y+W5raI5L+u5pS5CiAgICBjYW5jZWxVcGRhdGUoKSB7CiAgICAgIHRoaXMuYWN0aXZlTmFtZSA9IC0xIC8vIOWFs+mXreaKmOWPoOmdouadvwogICAgfSwKICAgIC8vIOehruiupOS/ruaUuQogICAgZG9VcGRhdGUocmlkLCBpbmRleCkgewogICAgICBsZXQgdHJlZSA9IHRoaXMuJHJlZnMudHJlZVJlZltpbmRleF0gLy8g6I635Y+W5byV55So5a+56LGh5ZKM57Si5byVCiAgICAgIGxldCBzZWxlY3RlZEtleXMgPSB0cmVlLmdldENoZWNrZWRLZXlzKHRydWUpIC8vIOiOt+WPlumAieS4reeahOiKgueCueaVsOe7hCx0cnVlIOS7hei/lOWbnuiiq+mAieS4reeahOWPtuWtkOiKgueCueeahCBrZXlzLOWmguS4iee6p+WIhuexuwogICAgICAvLyBjb25zb2xlLmxvZyhzZWxlY3RlZEtleXMpCiAgICAgIGxldCB1cmwgPSAnL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uLz9yaWQ9JyArIHJpZAogICAgICBzZWxlY3RlZEtleXMuZm9yRWFjaChrZXkgPT4gewogICAgICAgIC8vIOW+queOr+mBjeWOhuWHuuaVsOe7hCBpZCDvvIzmi7zmjqXlnKjkuIDotbcKICAgICAgICB1cmwgKz0gJyZtaWRzPScgKyBrZXkKICAgICAgfSkKICAgICAgdGhpcy5wdXRSZXF1ZXN0KHVybCkudGhlbihyZXNwID0+IHsKICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgdGhpcy5hY3RpdmVOYW1lID0gLTEgLy8g5YWz6Zet5oqY5Y+g6Z2i5p2/CiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIC8vIOaJi+mjjueQtOeCueWHu+S6i+S7tgogICAgY2hhbmdlKHJpZCkgewogICAgICBpZiAocmlkKSB7CiAgICAgICAgdGhpcy5pbml0QWxsTWVudXMoKSAvLyDosIPnlKjojrflj5bmiYDmnInoj5zljZUKICAgICAgICB0aGlzLmluaXRTZWxlY3RlZE1lbnVzKHJpZCkgLy8g6LCD55So6I635Y+W5omA5pyJ6YCJ5Lit55qE6I+c5Y2VCiAgICAgICAgLy8gYWxlcnQocmlkKSAvLyA6bmFtZT0ici5pZCIgIGxhYmVsOiAnbmFtZScKICAgICAgfQogICAgfSwKICAgIC8vIOiOt+WPluaJgOaciemAieS4reeahOiPnOWNlQogICAgaW5pdFNlbGVjdGVkTWVudXMocmlkKSB7IC8vIDpuYW1lPSJyLmlkIiAgY2hhbmdlKHJpZCkKICAgICAgdGhpcy5nZXRSZXF1ZXN0KCcvc3lzdGVtL2Jhc2ljL3Blcm1pc3Npb24vbWlkLycgKyByaWQpLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRNZW51cyA9IHJlc3AKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgLy8g6I635Y+W5omA5pyJ6I+c5Y2VCiAgICBpbml0QWxsTWVudXMoKSB7CiAgICAgIHRoaXMuZ2V0UmVxdWVzdCgnL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL21lbnVzJykudGhlbihyZXNwID0+IHsKICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgdGhpcy5hbGxNZW51cyA9IHJlc3AKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgLy8g6I635Y+W5omA5pyJ6KeS6ImyCiAgICBpbml0Um9sZXMoKSB7CiAgICAgIHRoaXMuZ2V0UmVxdWVzdCgnL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uLycpLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgIHRoaXMucm9sZXMgPSByZXNwCiAgICAgICAgfQogICAgICB9KQogICAgfQogIH0KfQo="},{"version":3,"sources":["PositionMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PositionMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\n  <div>\n    <div class=\"positionManaTool\">\n      <el-input v-model=\"role.name\" placeholder=\"请输入角色英文名\" size=\"small\">\n        <template slot=\"prepend\">ROLE_</template>\n      </el-input>\n      <el-input v-model=\"role.nameZh\" placeholder=\"请输入角色中文名\" size=\"small\" @keydown.enter.native=\"doAddRole\"></el-input>\n      <el-button type=\"primary\" icon=\"el-icon-plus\" size=\"mini\" @click=\"doAddRole\">添加角色</el-button>\n    </div>\n    <!-- 手风琴 -->\n    <div class=\"positionManaMain\">\n      <el-collapse v-model=\"activeName\" accordion @change=\"change\">\n        <el-collapse-item :title=\"r.nameZh\" :name=\"r.id\" v-for=\"(r,index) in roles\" :key=\"index\">\n          <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>可访问资源</span>\n              <el-button type=\"text\" icon=\"el-icon-delete\" style=\"float: right;padding: 3px 0;color: #f41f0a\" @click=\"doDeleteRole(r)\">\n              </el-button>\n            </div>\n            <div>\n              <el-tree ref=\"treeRef\" show-checkbox :data=\"allMenus\" :props=\"defaultProps\"\n                       :default-checked-keys=\"selectedMenus\"\n                       node-key=\"id\" :key=\"index\"></el-tree>\n              <div style=\"display: flex;justify-content: flex-end\">\n                <el-button size=\"mini\" @click=\"cancelUpdate\">取消修改</el-button>\n                <el-button size=\"mini\" type=\"primary\" @click=\"doUpdate(r.id,index)\">确认修改</el-button>\n              </div>\n            </div>\n          </el-card>\n        </el-collapse-item>\n      </el-collapse>\n    </div>\n  </div>\n</template>\n<script>\nexport default {\n  name: \"PositionMana\",\n  data() {\n    return {\n      role: {\n        name: '',\n        nameZh: ''\n      },\n      roles: [],\n      allMenus: [],\n      defaultProps: { // 树形控件\n        children: 'children',\n        label: 'name' // 绑定数据 :name=\"r.id\"\n      },\n      selectedMenus: [],\n      activeName: -1 // 折叠面板 默认关闭\n    }\n  },\n  mounted() {\n    this.initRoles()\n    this.initAllMenus()\n  },\n  methods: {\n    // 删除角色\n    doDeleteRole(role){\n      this.$confirm('此操作将永久删除[' + role.nameZh + ']角色, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.deleteRequest('/system/basic/permission/role/' + role.id).then(resp => {\n          if (resp) {\n            this.initRoles()\n          }\n        })\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n\n    },\n    // 添加角色\n    doAddRole(){\n      if (this.role.name && this.role.nameZh) {\n        this.postRequest('/system/basic/permission/role',this.role).then(resp=>{\n          if (resp) {\n            this.initRoles()\n            this.role.name = ''\n            this.role.nameZh = ''\n          }\n        })\n\n      }else {\n        this.$message.error('所有字段不能为空！')\n      }\n    },\n    // 取消修改\n    cancelUpdate() {\n      this.activeName = -1 // 关闭折叠面板\n    },\n    // 确认修改\n    doUpdate(rid, index) {\n      let tree = this.$refs.treeRef[index] // 获取引用对象和索引\n      let selectedKeys = tree.getCheckedKeys(true) // 获取选中的节点数组,true 仅返回被选中的叶子节点的 keys,如三级分类\n      // console.log(selectedKeys)\n      let url = '/system/basic/permission/?rid=' + rid\n      selectedKeys.forEach(key => {\n        // 循环遍历出数组 id ，拼接在一起\n        url += '&mids=' + key\n      })\n      this.putRequest(url).then(resp => {\n        if (resp) {\n          this.activeName = -1 // 关闭折叠面板\n        }\n      })\n    },\n    // 手风琴点击事件\n    change(rid) {\n      if (rid) {\n        this.initAllMenus() // 调用获取所有菜单\n        this.initSelectedMenus(rid) // 调用获取所有选中的菜单\n        // alert(rid) // :name=\"r.id\"  label: 'name'\n      }\n    },\n    // 获取所有选中的菜单\n    initSelectedMenus(rid) { // :name=\"r.id\"  change(rid)\n      this.getRequest('/system/basic/permission/mid/' + rid).then(resp => {\n        if (resp) {\n          this.selectedMenus = resp\n        }\n      })\n    },\n    // 获取所有菜单\n    initAllMenus() {\n      this.getRequest('/system/basic/permission/menus').then(resp => {\n        if (resp) {\n          this.allMenus = resp\n        }\n      })\n    },\n    // 获取所有角色\n    initRoles() {\n      this.getRequest('/system/basic/permission/').then(resp => {\n        if (resp) {\n          this.roles = resp\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.positionManaTool {\n  display: flex;\n  justify-content: flex-start;\n}\n\n.positionManaTool .el-input {\n  width: 300px;\n  margin-right: 6px;\n}\n\n.positionManaMain {\n  margin-top: 10px;\n  width: 700px;\n}\n</style>\n"]}]}