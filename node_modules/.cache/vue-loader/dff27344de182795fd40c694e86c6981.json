{"remainingRequest":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\src\\components\\sys\\basic\\DepMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\src\\components\\sys\\basic\\DepMana.vue","mtime":1611658510000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiRGVwTWFuYSIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7IC8vIDIKICAgICAgZmlsdGVyVGV4dDogJycsCiAgICAgIGRlcHM6IFtdLCAvLyDmiYDmnInpg6jpl6jmlbTkuKrmlbDnu4QKICAgICAgZGVmYXVsdFByb3BzOiB7IC8vIDIg5YWz6IGU5a2Q6YOo6ZeoCiAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicsCiAgICAgICAgbGFiZWw6ICduYW1lJwogICAgICB9LAogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwgLy8gMTQKICAgICAgZGVwOiB7IC8vIDE144CB5re75Yqg6YOo6Zeo5pWw5o2u6LGhCiAgICAgICAgbmFtZTogJycsCiAgICAgICAgcGFyZW50SWQ6IC0xLAogICAgICAgIGlzUGFyZW50OiAnJwogICAgICB9LAogICAgICBwbmFtZTogJycgLy8gMTXjgIHkuIrnuqfpg6jpl6jlkI3np7AKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICAvLyA044CB6KeC5a+f6ICF5LqL5Lu277yM55uR5o6n6L6T5YWl5qGG55qE5YC8KOahhuaetuaWueazle+8iQogICAgZmlsdGVyVGV4dCh2YWwpIHsKICAgICAgdGhpcy4kcmVmcy50cmVlLmZpbHRlcih2YWwpOwogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuaW5pdERlcHMoKSAgLy8gNuOAgeiwg+eUqOiOt+WPluaJgOaciemDqOmXqOaWueazlQogIH0sCiAgbWV0aG9kczogewogICAgLy8g5Yig6Zmk6YOo6Zeo6LCD55So55qE5pa55rOVCiAgICByZW1vdmVEZXBGcm9tRGVwcyhwLCBkZXBzLCBpZCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRlcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZCA9IGRlcHNbaV0KICAgICAgICBpZiAoZC5pZCA9PT0gaWQpIHsKICAgICAgICAgIGRlcHMuc3BsaWNlKGksIDEpCiAgICAgICAgICBpZiAoZGVwcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcC5pc1BhcmVudCA9IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucmVtb3ZlRGVwRnJvbURlcHMoZCwgZC5jaGlsZHJlbiwgaWQpCiAgICAgICAgfQoKICAgICAgfQoKICAgIH0sCiAgICAvLyAxMuOAgeWIoOmZpOmDqOmXqAogICAgZGVsZXRlRGVwKGRhdGEpIHsKICAgICAgLy8gY29uc29sZS5sb2coZGF0YSkKICAgICAgaWYgKGRhdGEuaXNQYXJlbnQpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfniLbpg6jpl6jliKDpmaTlpLHotKXvvIEnKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGNvbmZpcm0oJ+atpOaTjeS9nOWwhuawuOS5heWIoOmZpOivpVsnICsgZGF0YS5uYW1lICsgJ13pg6jpl6gsIOaYr+WQpue7p+e7rT8nLCAn5o+Q56S6JywgewogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuZGVsZXRlUmVxdWVzdCgnL3N5c3RlbS9iYXNpYy9kZXBhcnRtZW50LycgKyBkYXRhLmlkKS50aGVuKHJlc3AgPT4gewogICAgICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgICAgIHRoaXMucmVtb3ZlRGVwRnJvbURlcHMobnVsbCwgdGhpcy5kZXBzLCBkYXRhLmlkKQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAnaW5mbycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICflt7Llj5bmtojliKDpmaQnCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIC8vIDIw44CB5re75Yqg5a6M6YOo6ZeoIOWIneWni+WMliDmuIXnqbrmlbDmja4KICAgIGluaXREZXAoKSB7CiAgICAgIHRoaXMuZGVwID0gewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIHBhcmVudElkOiAtMQogICAgICB9CiAgICAgIHRoaXMucG5hbWUgPSAnJwogICAgfSwKICAgIC8vIDIy44CBIOmAkuW9kuafpeivouaJgOaciemDqOmXqOS/oeaBr++8jGRlcHMg5p+l6K+i5Yiw55qE5pW05Liq5pWw57uE77yMZGVwIOa3u+WKoOeahOmDqOmXqAogICAgYWRkRGVwMkRlcHMoZGVwcywgZGVwKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBkID0gZGVwc1tpXSAvLyDniLbpg6jpl6gKICAgICAgICBpZiAoZC5pZCA9PT0gZGVwLnBhcmVudElkKSB7CiAgICAgICAgICBkLmNoaWxkcmVuID0gZC5jaGlsZHJlbi5jb25jYXQoZGVwKSAvLyDmioogZGVwIOWKoOS4uiBkIOeahOWtkOmDqOmXqAogICAgICAgICAgaWYgKGQuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgICBkLmlzUGFyZW50ID0gdHJ1ZQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmFkZERlcDJEZXBzKGQuY2hpbGRyZW4sIGRlcCkgLy8g6YCS5b2S6LCD55So5q2k5pa55rOVIOS7peafpeivoue7k+aenOS4uuadoeS7tiDnu6fnu63mn6Xor6LlrZDpg6jpl6gKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyAxOeOAgeehruiupOa3u+WKoOmDqOmXqAogICAgZG9BZGREZXAoKSB7CiAgICAgIHRoaXMucG9zdFJlcXVlc3QoJy9zeXN0ZW0vYmFzaWMvZGVwYXJ0bWVudC8nLCB0aGlzLmRlcCkudGhlbihyZXNwID0+IHsKICAgICAgICBpZiAocmVzcCkgewogICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcCkKICAgICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlIC8vIOWFs+mXreWvueivneahhgogICAgICAgICAgdGhpcy5hZGREZXAyRGVwcyh0aGlzLmRlcHMsIHJlc3AuZGF0YSkgLy8gMjPjgIHjgJDml6DmlYjjgJHmiYvliqjmj5LlhaXpg6jpl6gg5pi+56S65re75Yqg5ZCO55qE5pWw5o2uCiAgICAgICAgICB0aGlzLmluaXREZXAoKSAvLyAyMeOAgeiwg+eUqOWIneWni+WMluaWueazlSDmuIXnqbrmlbDmja4KICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgLy8gMTHjgIExN+OAgea3u+WKoOmDqOmXqOW8ueahhgogICAgc2hvd0FkZERlcChkYXRhKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpCiAgICAgIHRoaXMuZGVwLnBhcmVudElkID0gZGF0YS5pZAogICAgICB0aGlzLnBuYW1lID0gZGF0YS5uYW1lCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUKICAgIH0sCgogICAgLy8gNeOAgeiOt+WPluaJgOaciemDqOmXqAogICAgaW5pdERlcHMoKSB7CiAgICAgIHRoaXMuZ2V0UmVxdWVzdCgnL3N5c3RlbS9iYXNpYy9kZXBhcnRtZW50LycpLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgIHRoaXMuZGVwcyA9IHJlc3AKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgLy8gM+OAgeS6i+S7tijmoYbmnrbmlrnms5XvvIkKICAgIGZpbHRlck5vZGUodmFsdWUsIGRhdGEpIHsgLy8gZGF0YSDmlbTooYzmlbDmja4KICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuIHRydWU7IC8vIHRydWUg6IqC54K55Y+v5Lul5bGV56S677yMZmFsc2Ug6IqC54K56ZqQ6JePCiAgICAgIHJldHVybiBkYXRhLm5hbWUuaW5kZXhPZih2YWx1ZSkgIT09IC0xOyAvLyBsYWJlbDogJ25hbWUnCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["DepMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DepMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\n  <div style=\"width: 500px\">\n    <!-- 1 -->\n    <el-input\n        placeholder=\"请输入部门名称进行搜索...\"\n        prefix-icon=\"el-icon-search\"\n        v-model=\"filterText\">\n    </el-input>\n    <!-- 9、:expand-on-click-node=\"false\" 点击小三角箭头才会展开\n            :default-expand-all=\"false\"\t设置默认不展开所有节点 -->\n    <el-tree\n        :data=\"deps\"\n        :props=\"defaultProps\"\n        default-expand-all\n        :filter-node-method=\"filterNode\"\n        :expand-on-click-node=\"false\"\n        ref=\"tree\">\n      <!-- 7、label: 'name' -->\n      <!-- 8、style=\"display: flex;justify-content: space-between;width: 100% 父容器宽度\" 让添加和删除按键居右 -->\n      <span class=\"custom-tree-node\" slot-scope=\"{ node, data }\"\n            style=\"display: flex;justify-content: space-between;width: 100%\">\n        <span>{{ data.name }}</span>\n        <span>\n          <el-button\n              plain\n              type=\"primary\"\n              size=\"mini\"\n              class=\"depBtn\"\n              @click=\"() => showAddDep(data)\">\n            添加部门\n          </el-button>\n          <!-- 10、showAddDep(data)  deleteDep(data)  data 后端传过来的完整的 json 对象 -->\n          <el-button\n              plain\n              type=\"danger\"\n              size=\"mini\"\n              class=\"depBtn\"\n              @click=\"() => deleteDep(data)\">\n            删除部门\n          </el-button>\n        </span>\n      </span>\n    </el-tree>\n    <!-- 13、对话弹框 -->\n    <el-dialog\n        title=\"添加部门\"\n        :visible.sync=\"dialogVisible\"\n        width=\"30%\">\n      <!-- 16 -->\n      <div>\n        <table>\n          <tr>\n            <td>\n              <el-tag>上级部门</el-tag>\n            </td>\n            <td>{{ pname }}</td>\n          </tr>\n          <tr>\n            <td>\n              <el-tag>部门名称</el-tag>\n            </td>\n            <td>\n              <el-input v-model=\"dep.name\" placeholder=\"请输入部门名称...\" size=\"small\"></el-input>\n            </td>\n          </tr>\n        </table>\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\n        <!-- 18、确定添加按钮绑定事件 @click=\"doAddDep\" -->\n        <el-button type=\"primary\" @click=\"doAddDep\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n<script>\nexport default {\n  name: \"DepMana\",\n  data() {\n    return { // 2\n      filterText: '',\n      deps: [], // 所有部门整个数组\n      defaultProps: { // 2 关联子部门\n        children: 'children',\n        label: 'name'\n      },\n      dialogVisible: false, // 14\n      dep: { // 15、添加部门数据象\n        name: '',\n        parentId: -1,\n        isParent: ''\n      },\n      pname: '' // 15、上级部门名称\n    }\n  },\n  watch: {\n    // 4、观察者事件，监控输入框的值(框架方法）\n    filterText(val) {\n      this.$refs.tree.filter(val);\n    }\n  },\n  mounted() {\n    this.initDeps()  // 6、调用获取所有部门方法\n  },\n  methods: {\n    // 删除部门调用的方法\n    removeDepFromDeps(p, deps, id) {\n      for (let i = 0; i < deps.length; i++) {\n        let d = deps[i]\n        if (d.id === id) {\n          deps.splice(i, 1)\n          if (deps.length === 0) {\n            p.isParent = false\n          }\n          return;\n        } else {\n          this.removeDepFromDeps(d, d.children, id)\n        }\n\n      }\n\n    },\n    // 12、删除部门\n    deleteDep(data) {\n      // console.log(data)\n      if (data.isParent) {\n        this.$message.error('父部门删除失败！')\n      } else {\n        this.$confirm('此操作将永久删除该[' + data.name + ']部门, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(() => {\n          this.deleteRequest('/system/basic/department/' + data.id).then(resp => {\n            if (resp) {\n              this.removeDepFromDeps(null, this.deps, data.id)\n            }\n          })\n        }).catch(() => {\n          this.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      }\n    },\n    // 20、添加完部门 初始化 清空数据\n    initDep() {\n      this.dep = {\n        name: '',\n        parentId: -1\n      }\n      this.pname = ''\n    },\n    // 22、 递归查询所有部门信息，deps 查询到的整个数组，dep 添加的部门\n    addDep2Deps(deps, dep) {\n      for (let i = 0; i < deps.length; i++) {\n        let d = deps[i] // 父部门\n        if (d.id === dep.parentId) {\n          d.children = d.children.concat(dep) // 把 dep 加为 d 的子部门\n          if (d.children.length > 0) {\n            d.isParent = true\n          }\n          return;\n        } else {\n          this.addDep2Deps(d.children, dep) // 递归调用此方法 以查询结果为条件 继续查询子部门\n        }\n      }\n    },\n    // 19、确认添加部门\n    doAddDep() {\n      this.postRequest('/system/basic/department/', this.dep).then(resp => {\n        if (resp) {\n          // console.log(resp)\n          this.dialogVisible = false // 关闭对话框\n          this.addDep2Deps(this.deps, resp.data) // 23、【无效】手动插入部门 显示添加后的数据\n          this.initDep() // 21、调用初始化方法 清空数据\n        }\n      })\n    },\n    // 11、17、添加部门弹框\n    showAddDep(data) {\n      // console.log(data)\n      this.dep.parentId = data.id\n      this.pname = data.name\n      this.dialogVisible = true\n    },\n\n    // 5、获取所有部门\n    initDeps() {\n      this.getRequest('/system/basic/department/').then(resp => {\n        if (resp) {\n          this.deps = resp\n        }\n      })\n    },\n    // 3、事件(框架方法）\n    filterNode(value, data) { // data 整行数据\n      if (!value) return true; // true 节点可以展示，false 节点隐藏\n      return data.name.indexOf(value) !== -1; // label: 'name'\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* 8 */\n.depBtn {\n  padding: 2px;\n}\n\n</style>\n"]}]}