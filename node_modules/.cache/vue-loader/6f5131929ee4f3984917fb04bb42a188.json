{"remainingRequest":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\src\\components\\sys\\basic\\PositionMana.vue?vue&type=style&index=0&id=405c6a5d&scoped=true&lang=css&","dependencies":[{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\src\\components\\sys\\basic\\PositionMana.vue","mtime":1611658510000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\广理学习\\JAVA框架项目\\乐字节-云E办\\乐字节-云E办前端\\yeb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnBvc2l0aW9uTWFuYVRvb2wgewogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBmbGV4LXN0YXJ0Owp9CgoucG9zaXRpb25NYW5hVG9vbCAuZWwtaW5wdXQgewogIHdpZHRoOiAzMDBweDsKICBtYXJnaW4tcmlnaHQ6IDZweDsKfQoKLnBvc2l0aW9uTWFuYU1haW4gewogIG1hcmdpbi10b3A6IDEwcHg7CiAgd2lkdGg6IDcwMHB4Owp9Cg=="},{"version":3,"sources":["PositionMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsJA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"PositionMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\n  <div>\n    <div class=\"positionManaTool\">\n      <el-input v-model=\"role.name\" placeholder=\"请输入角色英文名\" size=\"small\">\n        <template slot=\"prepend\">ROLE_</template>\n      </el-input>\n      <el-input v-model=\"role.nameZh\" placeholder=\"请输入角色中文名\" size=\"small\" @keydown.enter.native=\"doAddRole\"></el-input>\n      <el-button type=\"primary\" icon=\"el-icon-plus\" size=\"mini\" @click=\"doAddRole\">添加角色</el-button>\n    </div>\n    <!-- 手风琴 -->\n    <div class=\"positionManaMain\">\n      <el-collapse v-model=\"activeName\" accordion @change=\"change\">\n        <el-collapse-item :title=\"r.nameZh\" :name=\"r.id\" v-for=\"(r,index) in roles\" :key=\"index\">\n          <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>可访问资源</span>\n              <el-button type=\"text\" icon=\"el-icon-delete\" style=\"float: right;padding: 3px 0;color: #f41f0a\" @click=\"doDeleteRole(r)\">\n              </el-button>\n            </div>\n            <div>\n              <el-tree ref=\"treeRef\" show-checkbox :data=\"allMenus\" :props=\"defaultProps\"\n                       :default-checked-keys=\"selectedMenus\"\n                       node-key=\"id\" :key=\"index\"></el-tree>\n              <div style=\"display: flex;justify-content: flex-end\">\n                <el-button size=\"mini\" @click=\"cancelUpdate\">取消修改</el-button>\n                <el-button size=\"mini\" type=\"primary\" @click=\"doUpdate(r.id,index)\">确认修改</el-button>\n              </div>\n            </div>\n          </el-card>\n        </el-collapse-item>\n      </el-collapse>\n    </div>\n  </div>\n</template>\n<script>\nexport default {\n  name: \"PositionMana\",\n  data() {\n    return {\n      role: {\n        name: '',\n        nameZh: ''\n      },\n      roles: [],\n      allMenus: [],\n      defaultProps: { // 树形控件\n        children: 'children',\n        label: 'name' // 绑定数据 :name=\"r.id\"\n      },\n      selectedMenus: [],\n      activeName: -1 // 折叠面板 默认关闭\n    }\n  },\n  mounted() {\n    this.initRoles()\n    this.initAllMenus()\n  },\n  methods: {\n    // 删除角色\n    doDeleteRole(role){\n      this.$confirm('此操作将永久删除[' + role.nameZh + ']角色, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.deleteRequest('/system/basic/permission/role/' + role.id).then(resp => {\n          if (resp) {\n            this.initRoles()\n          }\n        })\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n\n    },\n    // 添加角色\n    doAddRole(){\n      if (this.role.name && this.role.nameZh) {\n        this.postRequest('/system/basic/permission/role',this.role).then(resp=>{\n          if (resp) {\n            this.initRoles()\n            this.role.name = ''\n            this.role.nameZh = ''\n          }\n        })\n\n      }else {\n        this.$message.error('所有字段不能为空！')\n      }\n    },\n    // 取消修改\n    cancelUpdate() {\n      this.activeName = -1 // 关闭折叠面板\n    },\n    // 确认修改\n    doUpdate(rid, index) {\n      let tree = this.$refs.treeRef[index] // 获取引用对象和索引\n      let selectedKeys = tree.getCheckedKeys(true) // 获取选中的节点数组,true 仅返回被选中的叶子节点的 keys,如三级分类\n      // console.log(selectedKeys)\n      let url = '/system/basic/permission/?rid=' + rid\n      selectedKeys.forEach(key => {\n        // 循环遍历出数组 id ，拼接在一起\n        url += '&mids=' + key\n      })\n      this.putRequest(url).then(resp => {\n        if (resp) {\n          this.activeName = -1 // 关闭折叠面板\n        }\n      })\n    },\n    // 手风琴点击事件\n    change(rid) {\n      if (rid) {\n        this.initAllMenus() // 调用获取所有菜单\n        this.initSelectedMenus(rid) // 调用获取所有选中的菜单\n        // alert(rid) // :name=\"r.id\"  label: 'name'\n      }\n    },\n    // 获取所有选中的菜单\n    initSelectedMenus(rid) { // :name=\"r.id\"  change(rid)\n      this.getRequest('/system/basic/permission/mid/' + rid).then(resp => {\n        if (resp) {\n          this.selectedMenus = resp\n        }\n      })\n    },\n    // 获取所有菜单\n    initAllMenus() {\n      this.getRequest('/system/basic/permission/menus').then(resp => {\n        if (resp) {\n          this.allMenus = resp\n        }\n      })\n    },\n    // 获取所有角色\n    initRoles() {\n      this.getRequest('/system/basic/permission/').then(resp => {\n        if (resp) {\n          this.roles = resp\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.positionManaTool {\n  display: flex;\n  justify-content: flex-start;\n}\n\n.positionManaTool .el-input {\n  width: 300px;\n  margin-right: 6px;\n}\n\n.positionManaMain {\n  margin-top: 10px;\n  width: 700px;\n}\n</style>\n"]}]}